<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Android POS Print Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 600px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .card {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .status {
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
            font-weight: bold;
        }
        .status.success { background: #d4edda; color: #155724; }
        .status.error { background: #f8d7da; color: #721c24; }
        .status.warning { background: #fff3cd; color: #856404; }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin: 5px;
        }
        button:hover { background: #0056b3; }
        button:disabled { background: #ccc; cursor: not-allowed; }
        .info { font-size: 14px; color: #666; margin: 10px 0; }
        pre { background: #f8f9fa; padding: 10px; border-radius: 4px; overflow-x: auto; }
    </style>
</head>
<body>
    <div class="card">
        <h1>üñ®Ô∏è Android POS Print Test</h1>
        <p class="info">Test if your Android app can communicate with the web interface</p>
    </div>

    <div class="card">
        <h2>üì° Connection Status</h2>
        <div id="status" class="status warning">Checking...</div>
        <div id="details"></div>
    </div>

    <div class="card">
        <h2>üß™ Test Actions</h2>
        <button onclick="checkConnection()">üîç Check Connection</button>
        <button onclick="connectPOS()">üîå Connect to Printer</button>
        <button onclick="testPrint()">üñ®Ô∏è Test Print</button>
        <button onclick="printSampleTicket()">üé´ Print Sample Ticket</button>
        <button onclick="testImagePrint()">üñºÔ∏è Test Image Print</button>
    </div>

    <div class="card">
        <h2>üìã Debug Info</h2>
        <pre id="debug"></pre>
    </div>

    <script>
        function log(message, type = 'info') {
            const debugEl = document.getElementById('debug');
            const timestamp = new Date().toLocaleTimeString();
            const color = type === 'error' ? 'red' : type === 'success' ? 'green' : 'black';
            debugEl.innerHTML += `<span style="color: ${color}">[${timestamp}] ${message}</span>\n`;
            debugEl.scrollTop = debugEl.scrollHeight;
        }

        function updateStatus(message, type) {
            const statusEl = document.getElementById('status');
            statusEl.textContent = message;
            statusEl.className = `status ${type}`;
        }

        function checkConnection() {
            log('Checking Android POS interface...', 'info');
            
            const details = {
                hasAndroidPOS: typeof window.AndroidPOS !== 'undefined',
                hasAndroidApp: typeof window.AndroidApp !== 'undefined',
                userAgent: navigator.userAgent,
                androidPOSMethods: window.AndroidPOS ? Object.keys(window.AndroidPOS) : []
            };

            let methodsList = '';
            if (details.hasAndroidPOS) {
                methodsList = '<br><strong>Available Methods:</strong><br>' + 
                    details.androidPOSMethods.map(m => `- ${m}`).join('<br>');
            }

            document.getElementById('details').innerHTML = `
                <div class="info">
                    <strong>AndroidPOS Available:</strong> ${details.hasAndroidPOS ? '‚úÖ Yes' : '‚ùå No'}<br>
                    <strong>AndroidApp Available:</strong> ${details.hasAndroidApp ? '‚úÖ Yes' : '‚ùå No'}<br>
                    <strong>User Agent:</strong> ${details.userAgent}
                    ${methodsList}
                </div>
            `;

            if (details.hasAndroidPOS) {
                log('‚úÖ AndroidPOS interface found!', 'success');
                
                // Check if connected
                try {
                    const isConnected = window.AndroidPOS.isConnected();
                    log(`Printer connected: ${isConnected}`, isConnected ? 'success' : 'info');
                    
                    if (isConnected) {
                        updateStatus('‚úÖ Connected to Printer', 'success');
                        
                        // Get status
                        try {
                            const status = window.AndroidPOS.getStatus();
                            log(`Printer status: ${status}`, 'info');
                        } catch (e) {
                            log(`Could not get status: ${e.message}`, 'error');
                        }
                    } else {
                        updateStatus('‚ö†Ô∏è Printer Not Connected', 'warning');
                    }
                } catch (e) {
                    log(`Error checking connection: ${e.message}`, 'error');
                    updateStatus('‚ùå Error Checking Connection', 'error');
                }
            } else {
                log('‚ùå AndroidPOS interface NOT found', 'error');
                log('Make sure you are running this in the Android app', 'error');
                updateStatus('‚ùå Not Running in Android App', 'error');
            }
        }

        function connectPOS() {
            if (typeof window.AndroidPOS === 'undefined') {
                log('‚ùå AndroidPOS not available', 'error');
                alert('This only works in the Android app');
                return;
            }

            log('Attempting to connect to POS device...', 'info');
            try {
                window.AndroidPOS.connectPOS();
                log('‚úÖ Connection request sent', 'success');
                
                // Check connection after 2 seconds
                setTimeout(() => {
                    checkConnection();
                }, 2000);
            } catch (e) {
                log(`‚ùå Connection failed: ${e.message}`, 'error');
            }
        }

        function testPrint() {
            if (typeof window.AndroidPOS === 'undefined') {
                log('‚ùå AndroidPOS not available', 'error');
                alert('This only works in the Android app');
                return;
            }

            log('Sending test print...', 'info');
            try {
                window.AndroidPOS.testPrint();
                log('‚úÖ Test print sent', 'success');
            } catch (e) {
                log(`‚ùå Test print failed: ${e.message}`, 'error');
            }
        }

        function printSampleTicket() {
            if (typeof window.AndroidPOS === 'undefined') {
                log('‚ùå AndroidPOS not available', 'error');
                alert('This only works in the Android app');
                return;
            }

            log('Printing sample ticket...', 'info');
            
            const sampleTicket = `
================================
      LOTTERY TICKET
================================
#12345678901234567
--------------------------------
Draw: 11:00 AM
Date: ${new Date().toLocaleDateString()}
================================

A. Standard
   1 2 3
   ‚Ç±10.00

B. Rambolito
   4 5 6
   ‚Ç±10.00

================================
         TOTAL AMOUNT
         ‚Ç±20.00
================================

Agent: Test Agent

[QR CODE]
12345678901234567

================================
       GOOD LUCK! üçÄ
================================
${new Date().toLocaleString()}
`;

            try {
                window.AndroidPOS.printReceipt(sampleTicket);
                log('‚úÖ Sample ticket sent to printer', 'success');
            } catch (e) {
                log(`‚ùå Print failed: ${e.message}`, 'error');
            }
        }

        function testImagePrint() {
            if (typeof window.AndroidPOS === 'undefined') {
                log('‚ùå AndroidPOS not available', 'error');
                alert('This only works in the Android app');
                return;
            }

            log('Testing image printing...', 'info');
            
            // Check if printImage method exists
            if (typeof window.AndroidPOS.printImage !== 'function') {
                log('‚ùå printImage method not available', 'error');
                log('Available methods: ' + Object.keys(window.AndroidPOS).join(', '), 'info');
                alert('printImage method not found!\n\nPlease update your Android app with the new printImage method.');
                return;
            }

            log('‚úÖ printImage method found!', 'success');
            
            // Create a simple test image (red square with text)
            const canvas = document.createElement('canvas');
            canvas.width = 384; // 58mm thermal printer width
            canvas.height = 200;
            const ctx = canvas.getContext('2d');
            
            // White background
            ctx.fillStyle = 'white';
            ctx.fillRect(0, 0, 384, 200);
            
            // Black border
            ctx.strokeStyle = 'black';
            ctx.lineWidth = 2;
            ctx.strokeRect(5, 5, 374, 190);
            
            // Text
            ctx.fillStyle = 'black';
            ctx.font = 'bold 24px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('TEST PRINT', 192, 60);
            
            ctx.font = '16px Arial';
            ctx.fillText('Image Printing Test', 192, 100);
            ctx.fillText(new Date().toLocaleTimeString(), 192, 130);
            
            // Convert to base64
            const base64Image = canvas.toDataURL('image/png').split(',')[1];
            
            log('üìÑ Test image generated, length: ' + base64Image.length, 'info');
            
            try {
                log('üñ®Ô∏è Sending image to printer...', 'info');
                window.AndroidPOS.printImage(base64Image);
                log('‚úÖ Image print command sent!', 'success');
            } catch (e) {
                log(`‚ùå Print failed: ${e.message}`, 'error');
            }
        }

        // Auto-check on page load
        window.addEventListener('load', () => {
            log('Page loaded, checking connection...', 'info');
            setTimeout(checkConnection, 500);
        });
    </script>
</body>
</html>
